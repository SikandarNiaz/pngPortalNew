<!--<script>angular.module('MyApp', ['ngMaterial', 'ngMessages', 'material.svgAssetsCache']);</script>-->
<mat-card class="mb-20">
    <mat-card-content>
      <mat-card-title>
        Merchandiser Tracker
        <i [ngClass]="{ 'fa fa-cog fa-spin': loading }"></i>
        <i
          style="cursor: pointer; color: black"
          *ngIf="!loading"
          class="material-icons refresh-btn"
          matTooltip="Refresh Stats"
          (click)="refresh()"
        >
          cached
        </i>
      </mat-card-title>
      <!-- <button
        style="margin-left: 1%"
        [disabled]="loading"
        mat-raised-button
        color="primary"
        (click)="refresh()"
      >
        Refresh
      </button> -->
    </mat-card-content>
  </mat-card>
  <mat-card *ngIf="trackedShops.length > 0">
    <section>
      <div class="row my-2">
        <div class="col-md-12">
          <!-- <div class="col-md-3"><label for="totalDistance">Total Distance Covered:{{totalDistanceCovered}} Km.</label></div> -->
          <button mat-raised-button color="primary" class="mr-2" (click)="play()">
            Play
          </button>
          <button
            mat-raised-button
            color="primary"
            class="mr-2"
            (click)="pause()"
          >
            Pause
          </button>
          <button
            mat-raised-button
            color="primary"
            class="mr-2"
            (click)="reset()"
          >
            Reset
          </button>
          <button mat-raised-button color="primary" class="mr-2" (click)="fast()">
            Fast
          </button>
          <button mat-raised-button color="primary" class="mr-2" (click)="slow()">
            Slow
          </button>
          <button mat-raised-button color="primary" class="mr-2" (click)="next()">Next</button>
                <button mat-raised-button color="primary" class="mr-2" (click)="prev()">Previous</button>
        </div>
      </div>
    </section>
  
    <mat-card *ngIf="trackedShops.length > 0">
      <div class="row">
        <div class="col-md-12">
          <div class="tableFixHead col-md-12">
            <table class="table table-bordered table-hover">
              <thead style="background: lightgray">
                <tr>
                  <!-- <th (click)="sortIt('captured')"
                    style="cursor: pointer">captured
                   <i class="material-icons arrow material-icons-arrow">
                      {{ getArrowType("captured") }}
                    </i>
                  </th> -->
                  <th>Captured</th>
                  <th>Visited</th>
                  <th>Route Time</th>
                  <th>Shop Time</th>
                  <th>Travel Time</th>
                  <th>Total Distance Covered</th>
                </tr>
              </thead>
  
              <tbody *ngIf="trackedShops.length > 0" class="trS14">
                <tr *ngFor="let shop of dataShops">
                  <td>
                    {{ shop.captured }}
                  </td>
  
                  <td>
                    {{ shop.visited }}
                  </td>
  
                  <td>
                    {{ shop.time_on_route }}
                  </td>
  
                  <td>
                    {{ shop.time_on_shop }}
                  </td>
  
                  <td>
                    {{ shop.travel_time }}
                  </td>
                  <td>{{ totalDistanceCovered }} Km</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
  
        <div class="col-md-6">
          <div
            class="tableFixHead col-md-12"
            style="overflow: auto; height: 400px; max-width: 100%"
          >
            <table class="table table-bordered table-hover">
              <thead style="background: lightgray">
                <tr>
                  <!-- <th (click)="sortIt('captured')"
                  style="cursor: pointer">captured
                 <i class="material-icons arrow material-icons-arrow">
                    {{ getArrowType("captured") }}
                  </i>
                </th> -->
  
                  <th>Shop Code</th>
                  <th>Shop Name</th>
                  <th>Shop Address</th>
                  <th>Start Time</th>
                  <th>End Time</th>
                  <th>Time Difference</th>
                  <th>Channel</th>
                </tr>
              </thead>
  
              <tbody
                *ngFor="let shop of visitedtrackedShops; let i = index"
                class="trS14"
              >
                <tr *ngIf="shop.Type == 'Visit'">
                  <td>
                    {{ shop.shop_code }}
                  </td>
  
                  <td>
                    {{ shop.shop_title }}
                  </td>
                  <td>
                    {{ shop.address }}
                  </td>
                  <td>
                    {{ shop.time }}
                  </td>
                  <td>
                    {{ shop.end_time }}
                  </td>
                  <td>
                    {{ shop.time_difference }}
                  </td>
                  <td>
                    {{ shop.channel }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
  
        <div class="col-md-6">
          <section class="example-section">
            <agm-map
              [latitude]="lat"
              [longitude]="lng"
              [fitBounds]="trackedShops.length > 0"
              [zoom]="16"
              style="height: 600px"
              (mapReady)="onMapReady($event)"
            >
  
              <ng-container *ngFor="let shop of trackedShops">
                <!-- <div *ngIf="shop.remarks_id==1"> -->
                  <agm-marker
                  [agmFitBounds]="true"
                  latitude="{{ shop.latitude }}"
                  longitude="{{ shop.longitude }}"
                  iconUrl="{{ colorType + 'yellow' + '.png' }}"
                  [visible]="shop.isVisible && shop.remarks_id==1" 
                 
                >
                  <agm-snazzy-info-window
                    [maxWidth]="400"
                    [isOpen]="shop.isVisible"
                    [closeWhenOthersOpen]="true"
                  >
                  <ng-template>
                    <table>
                      <tr>
                        <td>
                          <strong>Time:</strong> 
                        </td>
                        <td>
                          {{ shop.time }}
                        </td>
                      </tr>
                      <tr>
                        <td>
                        <strong> End Time:</strong> 
                        </td>
                        <td>
                          {{ shop.end_time }}
                        </td>
                      </tr>
                      <tr>
                        <td>
                        <strong> Shop Code:</strong> 
                        </td>
                        <td>
                          {{ shop.shop_code }}
                        </td>
                      </tr>
                      <tr>
                        <td>
                        <strong> Shop Name:</strong> 
                        </td>
                        <td>
                          {{ shop.shop_title }}
                        </td>
                      </tr>
                      <tr>
                        <td>
                        <strong> Channel:</strong> 
                        </td>
                        <td>
                          {{ shop.channel }}
                        </td>
                      </tr>
                      <tr>
                        <td>
                        <strong> Time Diff:</strong>
                        </td>
                        <td>
                          {{ shop.time_difference }}
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <a (click)="goToEvaluation(shop)">
                            <button backgroundcolor="#2196F3">
                              Go To Details
                            </button></a
                          >
                        </td>
                      </tr>
                    </table>
                  </ng-template>
                    <!-- <ng-template>
                      <strong>Start Time:</strong> {{ shop.time }}
                      <br />
                      <strong>End Time:</strong> {{ shop.end_time }}
                      <br />
                      <strong>Shop Code:</strong> {{ shop.shop_code }}
                      <br />
                      <strong>Shop Name:</strong> {{ shop.shop_title }}
                      <br />
                      <strong>Channel:</strong> {{ shop.channel }}
                      <br />
                      <strong>Time Diff:</strong> {{ shop.time_difference }}
                      <br />
                      <a (click)="goToEvaluation(shop)">
                        <button backgroundcolor="#2196F3">
                          Go To Details
                        </button></a
                      >
                    </ng-template> -->
                  </agm-snazzy-info-window>
                </agm-marker>
                <!-- </div> -->
                
                <!-- <div *ngIf="shop.remarks_id!=1"> -->
                  <agm-marker
                  [agmFitBounds]="true"
                  latitude="{{ shop.latitude }}"
                  longitude="{{ shop.longitude }}"
                  iconUrl="{{ colorType + 'red' + '.png' }}"
                  [visible]="shop.isVisible && shop.remarks_id != 1"
                >
                  <agm-snazzy-info-window
                    [maxWidth]="400"
                    [isOpen]="shop.isVisible"
                    [closeWhenOthersOpen]="true"
                    wrapperClass="si-wrapper-top si-has-border"
                    shadowClass="si-shadow-wrapper-top"
                    pointerClass="si-shadow-pointer-top"
                  >
                    <ng-template>
                      <div class="si-frame si-shadow-frame">
                        <table class="custom-table">
                          <tr>
                            <td><strong>Start Time:</strong></td>
                            <td>{{ shop.time }}</td>
                          </tr>
                          <tr>
                            <td><strong>End Time:</strong></td>
                            <td>{{ shop.end_time }}</td>
                          </tr>
                          <tr>
                            <td><strong>Shop Code:</strong></td>
                            <td>{{ shop.shop_code }}</td>
                          </tr>
                          <tr>
                            <td><strong>Shop Name:</strong></td>
                            <td>{{ shop.shop_title }}</td>
                          </tr>
                          <tr>
                            <td><strong>Channel:</strong></td>
                            <td>{{ shop.channel }}</td>
                          </tr>
                          <tr>
                            <td><strong>Time Diff:</strong></td>
                            <td>{{ shop.time_difference }}</td>
                          </tr>
                          <tr>
                            <td colspan="2">
                              <button class="details-button" (click)="goToEvaluation(shop)">
                                Go To Details
                              </button>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </ng-template>
                  </agm-snazzy-info-window>
                </agm-marker>
                
                
                <!-- </div> -->
              </ng-container>
            </agm-map>
          </section>
        </div>
      </div>
    </mat-card>
  </mat-card>
  <div
    *ngIf="loading"
    class="text-center"
    flFlex
    flexLayout="row "
    flexLayout.lt-md="column "
  >
    <div fxFlex class="img-center">
      <img
        src="assets/images/loading.gif"
        alt=" "
        srcset=""
        height="300"
        width="300"
      />
    </div>
  </div>
  